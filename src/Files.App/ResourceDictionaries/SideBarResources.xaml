<!--  Copyright (c) Microsoft Corporation and Contributors.  -->
<!--  Licensed under the MIT License.  -->

<ResourceDictionary
	x:Class="Files.App.UserControls.Sidebar.SidebarResources"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:animatedvisuals="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
	xmlns:local="using:Files.App.UserControls.Sidebar">

	<DataTemplate x:Key="DefaultSidebarItemTemplate">
		<local:SidebarItem AutomationProperties.AutomationId="{Binding Text, Mode=OneWay}" Item="{Binding}" />
	</DataTemplate>

	<Style TargetType="local:SidebarItem">
		<Setter Property="IsTabStop" Value="False" />
		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="local:SidebarItem">
					<Grid x:Name="RootPanel">
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
						</Grid.RowDefinitions>

						<Rectangle
							x:Name="DragTargetIndicator"
							Grid.ColumnSpan="3"
							Height="4"
							Margin="4,-2"
							HorizontalAlignment="Stretch"
							VerticalAlignment="Top"
							AutomationProperties.AccessibilityView="Raw"
							Fill="{ThemeResource SurfaceStrokeColorDefaultBrush}"
							RadiusX="4"
							RadiusY="4"
							Visibility="Collapsed" />

						<Grid
							x:Name="ElementGrid"
							Grid.Row="0"
							Height="30"
							Margin="4,0"
							HorizontalAlignment="Stretch"
							Background="{ThemeResource SubtleFillColorTransparentBrush}"
							BorderThickness="1"
							CornerRadius="{ThemeResource ControlCornerRadius}"
							IsTabStop="True"
							TabFocusNavigation="Once"
							ToolTipService.ToolTip="{Binding ToolTip, Mode=OneWay}"
							UseSystemFocusVisuals="True">
							<Grid.ColumnDefinitions>
								<ColumnDefinition x:Name="IconColumn" Width="40" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="Auto" />
							</Grid.ColumnDefinitions>

							<Rectangle
								x:Name="SelectionIndicator"
								Width="3"
								Height="16"
								HorizontalAlignment="Left"
								VerticalAlignment="Center"
								AutomationProperties.AccessibilityView="Raw"
								Fill="{ThemeResource AccentFillColorDefaultBrush}"
								Opacity="0"
								RadiusX="2"
								RadiusY="2" />

							<ContentPresenter
								x:Name="IconPresenter"
								Width="16"
								Height="16"
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								AutomationProperties.AccessibilityView="Raw"
								Content="{Binding Icon, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" />
							<TextBlock
								x:Name="ItemNameTextBlock"
								Grid.Column="1"
								HorizontalAlignment="Stretch"
								VerticalAlignment="Center"
								AutomationProperties.AccessibilityView="Raw"
								Text="{Binding Text, Mode=OneWay}" />

							<AnimatedIcon
								x:Name="ExpandCollapseChevron"
								Grid.Column="3"
								Width="{StaticResource ExpanderChevronGlyphSize}"
								Height="{StaticResource ExpanderChevronGlyphSize}"
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								AnimatedIcon.State="NormalOff"
								AutomationProperties.AccessibilityView="Raw"
								Foreground="{ThemeResource ExpanderChevronForeground}"
								RenderTransformOrigin="0.5, 0.5"
								Visibility="Collapsed">
								<animatedvisuals:AnimatedChevronUpDownSmallVisualSource />
								<AnimatedIcon.FallbackIconSource>
									<FontIconSource
										FontFamily="{StaticResource SymbolThemeFontFamily}"
										FontSize="12"
										Glyph="{StaticResource ExpanderChevronDownGlyph}"
										IsTextScaleFactorEnabled="False" />
								</AnimatedIcon.FallbackIconSource>
								<AnimatedIcon.RenderTransform>
									<RotateTransform x:Name="ExpandCollapseChevronRotateTransform" Angle="0" />
								</AnimatedIcon.RenderTransform>
							</AnimatedIcon>

							<FontIcon
								x:Name="ExpanderIcon"
								Grid.Column="2"
								Margin="8,0,14,0"
								AutomationProperties.AccessibilityView="Raw"
								FontSize="8"
								Glyph="&#xE70E;"
								Visibility="Collapsed" />

							<FlyoutBase.AttachedFlyout>
								<Flyout x:Name="ChildrenFlyout" Placement="Right">
									<Flyout.FlyoutPresenterStyle>
										<Style BasedOn="{StaticResource DefaultFlyoutPresenterStyle}" TargetType="FlyoutPresenter">
											<Setter Target="Padding" Value="0,4" />
											<Setter Target="MinWidth" Value="200" />
											<Setter Target="MinHeight" Value="20" />
										</Style>
									</Flyout.FlyoutPresenterStyle>
									<ItemsRepeater
										x:Name="FlyoutChildrenPresenter"
										HorizontalAlignment="Stretch"
										local:SidebarItem.TemplateRoot="{Binding ElementName=RootPanel}"
										AutomationProperties.AccessibilityView="Content"
										ItemsSource="{Binding ChildItems, Mode=OneWay}"
										XYFocusKeyboardNavigation="Enabled">
										<ItemsRepeater.ItemTemplate>
											<DataTemplate>
												<local:SidebarItem
													AutomationProperties.AutomationId="{Binding Text, Mode=OneWay}"
													IsInFlyout="True"
													Item="{Binding}" />
											</DataTemplate>
										</ItemsRepeater.ItemTemplate>
									</ItemsRepeater>
								</Flyout>
							</FlyoutBase.AttachedFlyout>
						</Grid>

						<ItemsRepeater
							x:Name="ChildrenPresenter"
							Grid.Row="2"
							HorizontalAlignment="Stretch"
							local:SidebarItem.TemplateRoot="{Binding ElementName=RootPanel}"
							AutomationProperties.AccessibilityView="Content"
							ItemTemplate="{StaticResource DefaultSidebarItemTemplate}"
							ItemsSource="{Binding ChildItems, Mode=OneWay}"
							Visibility="Collapsed"
							XYFocusKeyboardNavigation="Enabled">
							<ItemsRepeater.Layout>
								<StackLayout Spacing="4" />
							</ItemsRepeater.Layout>
						</ItemsRepeater>
						<VisualStateManager.VisualStateGroups>
							<VisualStateGroup x:Name="ExpansionStates">
								<VisualState x:Name="NoExpansion" />
								<VisualState x:Name="Expanded">
									<VisualState.Setters>
										<Setter Target="ChildrenPresenter.Visibility" Value="Visible" />
										<Setter Target="IconPresenter.Visibility" Value="Collapsed" />
										<Setter Target="IconColumn.Width" Value="8" />
										<Setter Target="ExpandCollapseChevron.Visibility" Value="Visible" />
										<Setter Target="ItemNameTextBlock.FontSize" Value="12" />
										<Setter Target="ItemNameTextBlock.FontWeight" Value="SemiBold" />
										<Setter Target="ItemNameTextBlock.Foreground" Value="{ThemeResource TextFillColorTertiaryBrush}" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="Collapsed">
									<VisualState.Setters>
										<Setter Target="IconPresenter.Visibility" Value="Collapsed" />
										<Setter Target="IconColumn.Width" Value="8" />
										<Setter Target="ExpandCollapseChevron.Visibility" Value="Visible" />
										<Setter Target="ItemNameTextBlock.FontSize" Value="12" />
										<Setter Target="ItemNameTextBlock.FontWeight" Value="SemiBold" />
										<Setter Target="ItemNameTextBlock.Foreground" Value="{ThemeResource TextFillColorTertiaryBrush}" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>

							<VisualStateGroup x:Name="ExpansionIconStates">
								<VisualState x:Name="NoEXpansionIconState" />
								<VisualState x:Name="ExpandedIconNormal">
									<VisualState.Setters>
										<Setter Target="ExpandCollapseChevron.(AnimatedIcon.State)" Value="NormalOn" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="ExpandedIconPressed">
									<VisualState.Setters>
										<Setter Target="ExpandCollapseChevron.(AnimatedIcon.State)" Value="PressedOn" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="CollapsedIconNormal">
									<VisualState.Setters>
										<Setter Target="ExpandCollapseChevron.(AnimatedIcon.State)" Value="NormalOff" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="CollapsedIconPressed">
									<VisualState.Setters>
										<Setter Target="ExpandCollapseChevron.(AnimatedIcon.State)" Value="PressedOff" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>

							<VisualStateGroup x:Name="SelectionStates">
								<VisualState x:Name="Unselected" />
								<VisualState x:Name="Selected">
									<VisualState.Setters>
										<Setter Target="SelectionIndicator.Opacity" Value="1" />
										<Setter Target="ElementGrid.BorderBrush" Value="{ThemeResource ButtonBorderBrush}" />
										<Setter Target="ElementGrid.Background" Value="{ThemeResource ControlFillColorDefaultBrush}" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>

							<VisualStateGroup x:Name="PointerStates">
								<VisualState x:Name="Normal" />
								<VisualState x:Name="NormalSelected">
									<VisualState.Setters>
										<Setter Target="ElementGrid.Background" Value="{ThemeResource ControlFillColorDefaultBrush}" />
										<Setter Target="ElementGrid.BorderBrush" Value="{ThemeResource ButtonBorderBrush}" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="PointerOver">
									<VisualState.Setters>
										<Setter Target="ElementGrid.Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="PointerOverSelected">
									<VisualState.Setters>
										<Setter Target="ElementGrid.Background" Value="{ThemeResource ControlFillColorSecondaryBrush}" />
										<Setter Target="ElementGrid.BorderBrush" Value="{ThemeResource ButtonBorderBrush}" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="Pressed">
									<VisualState.Setters>
										<Setter Target="ElementGrid.Background" Value="{ThemeResource SubtleFillColorTertiaryBrush}" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="PressedSelected">
									<VisualState.Setters>
										<Setter Target="ElementGrid.Background" Value="{ThemeResource ControlFillColorTertiaryBrush}" />
										<Setter Target="ElementGrid.BorderBrush" Value="{ThemeResource ButtonBorderBrush}" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>

							<VisualStateGroup x:Name="DragTargetStates">
								<VisualState x:Name="NoDrag" />
								<VisualState x:Name="DragInsertAbove">
									<VisualState.Setters>
										<Setter Target="DragTargetIndicator.Visibility" Value="Visible" />
										<Setter Target="DragTargetIndicator.VerticalAlignment" Value="Top" />
										<Setter Target="ElementGrid.Margin" Value="4,-2" />
										<Setter Target="ElementGrid.Height" Value="34" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="DragInsertBelow">
									<VisualState.Setters>
										<Setter Target="DragTargetIndicator.Visibility" Value="Visible" />
										<Setter Target="DragTargetIndicator.VerticalAlignment" Value="Bottom" />
									</VisualState.Setters>
								</VisualState>
								<VisualState x:Name="DragOnTop">
									<VisualState.Setters>
										<Setter Target="ElementGrid.Background" Value="{ThemeResource ControlFillColorTertiaryBrush}" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>

							<VisualStateGroup x:Name="DisplayModes">
								<VisualState x:Name="NonCompact" />
								<VisualState x:Name="Compact">
									<VisualState.Setters>
										<Setter Target="RootPanel.MaxWidth" Value="56" />
										<Setter Target="ItemNameTextBlock.Visibility" Value="Collapsed" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>
						</VisualStateManager.VisualStateGroups>
					</Grid>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>
</ResourceDictionary>
