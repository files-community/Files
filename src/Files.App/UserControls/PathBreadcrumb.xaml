<!--  Copyright (c) 2023 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<UserControl
	x:Class="Files.App.UserControls.PathBreadcrumb"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:core="using:Microsoft.Xaml.Interactions.Core"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:dataitem="using:Files.App.Data.Items"
	xmlns:i="using:Microsoft.Xaml.Interactivity"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:templateselectors="using:Files.App.Data.TemplateSelectors"
	DataContext="{x:Bind ViewModel, Mode=OneWay}"
	mc:Ignorable="d">

	<UserControl.Resources>
		<ResourceDictionary>

			<!--  Item Selector  -->
			<templateselectors:PathBreadcrumbItemSelector
				x:Key="PathBreadcrumbItemSelector"
				CurrentItem="{StaticResource CurrentItem}"
				ParentItems="{StaticResource ParentItems}" />

			<!--  Current Item Style  -->
			<DataTemplate x:Name="CurrentItem" x:DataType="dataitem:PathBreadcrumbItem">
				<StackPanel
					x:Name="ListViewItemContentGrid"
					AllowDrop="True"
					AutomationProperties.Name="{x:Bind Name, Mode=OneWay}"
					Background="Transparent"
					DragLeave="PathBreadcrumbItem_DragLeave"
					DragOver="PathBreadcrumbItem_DragOver"
					Drop="PathBreadcrumbItem_Drop"
					Orientation="Horizontal"
					Tag="{x:Bind Path, Mode=OneWay}">
					<i:Interaction.Behaviors>
						<core:EventTriggerBehavior EventName="PointerEntered">
							<core:ChangePropertyAction PropertyName="Opacity" Value="0.7" />
						</core:EventTriggerBehavior>
						<core:EventTriggerBehavior EventName="PointerExited">
							<core:ChangePropertyAction PropertyName="Opacity" Value="1.0" />
						</core:EventTriggerBehavior>
					</i:Interaction.Behaviors>

					<!--  Header  -->
					<TextBlock
						Margin="0,0,4,0"
						FontSize="12"
						Style="{StaticResource BodyStrongTextBlockStyle}"
						Text="{x:Bind Name, Mode=OneWay}" />

				</StackPanel>
			</DataTemplate>

			<!--  Parent Item Style  -->
			<DataTemplate x:Name="ParentItems" x:DataType="dataitem:PathBreadcrumbItem">
				<StackPanel
					x:Name="ListViewItemContentGrid"
					VerticalAlignment="Center"
					AllowDrop="True"
					AutomationProperties.Name="{x:Bind Name, Mode=OneWay}"
					Background="Transparent"
					DragLeave="PathBreadcrumbItem_DragLeave"
					DragOver="PathBreadcrumbItem_DragOver"
					Drop="PathBreadcrumbItem_Drop"
					Orientation="Horizontal"
					Spacing="4"
					Tag="{x:Bind Path, Mode=OneWay}">

					<!--  Header  -->
					<TextBlock
						Margin="0,4"
						FontSize="12"
						PointerPressed="PathBreadcrumbItem_PointerPressed"
						Tapped="PathBreadcrumbItem_Tapped"
						Text="{x:Bind Name, Mode=OneWay}">
						<i:Interaction.Behaviors>
							<core:EventTriggerBehavior EventName="PointerEntered">
								<core:ChangePropertyAction PropertyName="Opacity" Value="0.7" />
							</core:EventTriggerBehavior>
							<core:EventTriggerBehavior EventName="PointerExited">
								<core:ChangePropertyAction PropertyName="Opacity" Value="1.0" />
							</core:EventTriggerBehavior>
						</i:Interaction.Behaviors>
					</TextBlock>

					<!--  Chevron  -->
					<FontIcon
						x:Name="PathSeaparatorIcon"
						DataContextChanged="PathBreadcrumbItemChevron_DataContextChanged"
						FontSize="12"
						Glyph="&#xE76C;"
						Loaded="PathBreadcrumbItemChevron_Loaded">
						<i:Interaction.Behaviors>
							<core:EventTriggerBehavior EventName="PointerEntered">
								<core:ChangePropertyAction PropertyName="Opacity" Value="0.7" />
							</core:EventTriggerBehavior>
							<core:EventTriggerBehavior EventName="PointerExited">
								<core:ChangePropertyAction PropertyName="Opacity" Value="1.0" />
							</core:EventTriggerBehavior>
						</i:Interaction.Behaviors>

						<!--  Child Items  -->
						<FontIcon.ContextFlyout>
							<MenuFlyout
								Opened="PathBreadcrumbItemFlyout_Opened"
								Placement="BottomEdgeAlignedLeft"
								ScrollViewer.VerticalScrollBarVisibility="Auto"
								ScrollViewer.VerticalScrollMode="Auto">
								<MenuFlyout.MenuFlyoutPresenterStyle>
									<Style TargetType="MenuFlyoutPresenter">
										<Setter Property="MaxHeight" Value="400" />
									</Style>
								</MenuFlyout.MenuFlyoutPresenterStyle>
							</MenuFlyout>
						</FontIcon.ContextFlyout>

					</FontIcon>

				</StackPanel>
			</DataTemplate>

		</ResourceDictionary>
	</UserControl.Resources>

	<ListView
		x:Name="PathViewInteract"
		Padding="6,0,12,0"
		VerticalAlignment="Stretch"
		HorizontalContentAlignment="Stretch"
		VerticalContentAlignment="Stretch"
		Background="Transparent"
		CanReorderItems="False"
		CornerRadius="{StaticResource ControlCornerRadius}"
		IsItemClickEnabled="True"
		ItemTemplateSelector="{StaticResource PathBreadcrumbItemSelector}"
		ItemsSource="{x:Bind ViewModel.PathBreadcrumbItems, Mode=OneWay}"
		ScrollViewer.HorizontalScrollBarVisibility="Hidden"
		ScrollViewer.HorizontalScrollMode="Enabled"
		ScrollViewer.VerticalScrollBarVisibility="Disabled"
		ScrollViewer.VerticalScrollMode="Disabled"
		SelectionMode="None">

		<!--  Defines Item Enumerating Direction  -->
		<ListView.ItemsPanel>
			<ItemsPanelTemplate>
				<ItemsStackPanel
					Background="Transparent"
					ItemsUpdatingScrollMode="KeepLastItemInView"
					Orientation="Horizontal" />
			</ItemsPanelTemplate>
		</ListView.ItemsPanel>

		<!--  Item style  -->
		<ListView.ItemContainerStyle>
			<Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
				<Setter Property="MinWidth" Value="1" />
				<Setter Property="MinHeight" Value="32" />
				<Setter Property="VerticalAlignment" Value="Center" />
				<Setter Property="Padding" Value="8,0,4,0" />
				<Setter Property="Margin" Value="-4,0" />
			</Style>
		</ListView.ItemContainerStyle>

		<!--  Remove All Transitions  -->
		<ListView.ItemContainerTransitions>
			<TransitionCollection />
		</ListView.ItemContainerTransitions>

	</ListView>

</UserControl>
