<!--  Copyright (c) 2023 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<UserControl
	x:Class="Files.App.UserControls.StatusCenter"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:converters1="using:CommunityToolkit.WinUI.UI.Converters"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:statuscenter="using:Files.App.Utils.StatusCenter"
	xmlns:wcttriggers="using:CommunityToolkit.WinUI.UI.Triggers"
	x:Name="ControlRoot"
	DataContext="{x:Bind ViewModel, Mode=OneWay}"
	mc:Ignorable="d">

	<UserControl.Resources>
		<converters1:BoolNegationConverter x:Key="BoolNegationConverter" />
	</UserControl.Resources>

	<Grid Margin="-16">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<Grid Padding="12" ColumnSpacing="12">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="Auto" />
			</Grid.ColumnDefinitions>

			<TextBlock
				VerticalAlignment="Center"
				Style="{StaticResource BodyTextBlockStyle}"
				Text="{helpers:ResourceString Name=StatusCenter}" />

			<Button
				x:Name="CloseAllBannersButton"
				Grid.Column="1"
				Height="24"
				Padding="8,0"
				HorizontalAlignment="Right"
				Command="{x:Bind ViewModel.CloseAllCommand, Mode=OneWay}"
				ToolTipService.ToolTip="{helpers:ResourceString Name=ClearAll}">
				<TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{helpers:ResourceString Name=ClearAll}" />
			</Button>

		</Grid>

		<Border
			Grid.Row="1"
			Height="1"
			Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

		<!--  List of status center items  -->
		<ListView
			x:Name="StatusCenterItemsListView"
			Grid.Row="2"
			Padding="4"
			VerticalAlignment="Stretch"
			ItemsSource="{x:Bind ViewModel.StatusCenterItems, Mode=OneWay}"
			SelectionMode="None">

			<ListView.ItemContainerStyle>
				<Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
					<Setter Property="Padding" Value="0,2" />
				</Style>
			</ListView.ItemContainerStyle>

			<ListView.ItemTemplate>
				<DataTemplate x:DataType="statuscenter:StatusCenterItem">
					<UserControl>
						<Grid
							x:Name="ContentRoot"
							Padding="16"
							HorizontalAlignment="Stretch"
							AutomationProperties.Name="{x:Bind FullTitle, Mode=OneWay}"
							Background="{StaticResource InfoBarInformationalSeverityBackgroundBrush}"
							BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
							BorderThickness="1"
							ColumnSpacing="12"
							CornerRadius="{StaticResource ControlCornerRadius}">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="Auto" />
							</Grid.ColumnDefinitions>

							<TextBlock
								x:Name="SeverityBackgroundFontIcon"
								Grid.Column="0"
								VerticalAlignment="Center"
								FontFamily="{ThemeResource SymbolThemeFontFamily}"
								FontSize="16"
								Text="&#xF136;" />

							<TextBlock
								x:Name="SeverityForegroundFontIcon"
								Grid.Column="0"
								VerticalAlignment="Center"
								FontFamily="{ThemeResource SymbolThemeFontFamily}"
								FontSize="16"
								Foreground="{ThemeResource TextFillColorInverseBrush}"
								Text="{x:Bind StatusIcon}" />

							<StackPanel Grid.Column="1">

								<TextBlock
									MaxLines="1"
									Style="{StaticResource BodyStrongTextBlockStyle}"
									Text="{x:Bind FullTitle, Mode=OneWay}" />

								<ProgressBar
									x:Name="ProgressBar"
									Margin="0,8"
									IsIndeterminate="{x:Bind IsCancelled, Mode=OneWay}"
									Visibility="{x:Bind IsProgressing, Mode=OneWay}"
									Value="{x:Bind Progress, Mode=OneWay}" />

								<TextBlock
									Foreground="{ThemeResource TextFillColorSecondaryBrush}"
									MaxLines="1"
									Style="{StaticResource CaptionTextBlockStyle}"
									Text="{x:Bind Message, Mode=OneWay}" />

							</StackPanel>

							<Grid Grid.Column="2">

								<Button
									x:Name="CancelItemButton"
									Width="32"
									Height="32"
									Padding="0"
									x:Load="{x:Bind CancelButtonVisible}"
									AutomationProperties.Name="{helpers:ResourceString Name=Cancel}"
									Background="Transparent"
									BorderBrush="Transparent"
									Command="{x:Bind CancelCommand}"
									DataContext="{x:Bind}"
									IsEnabled="{x:Bind IsCancelled, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
									ToolTipService.ToolTip="{helpers:ResourceString Name=Cancel}">
									<Button.Content>
										<FontIcon FontSize="16" Glyph="&#xE711;" />
									</Button.Content>
								</Button>

								<Button
									x:Name="CloseItemButton"
									Width="32"
									Height="32"
									Padding="0"
									x:Load="{x:Bind CancelButtonVisible, Converter={StaticResource BoolNegationConverter}}"
									AutomationProperties.Name="{helpers:ResourceString Name=Clear}"
									Background="Transparent"
									BorderBrush="Transparent"
									Command="{Binding ElementName=ControlRoot, Path=DataContext.CloseItemCommand}"
									CommandParameter="{x:Bind}"
									ToolTipService.ToolTip="{helpers:ResourceString Name=Clear}">
									<Button.Content>
										<FontIcon FontSize="16" Glyph="&#xE711;" />
									</Button.Content>
								</Button>

							</Grid>

							<VisualStateManager.VisualStateGroups>
								<VisualStateGroup>
									<VisualState x:Name="Normal">
										<VisualState.StateTriggers>
											<wcttriggers:CompareStateTrigger
												Comparison="Equal"
												Value="{x:Bind StatusNumber}"
												To="0" />
										</VisualState.StateTriggers>
										<VisualState.Setters>
											<Setter Target="ContentRoot.Background" Value="{ThemeResource InfoBarInformationalSeverityBackgroundBrush}" />
											<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource InfoBarInformationalSeverityIconBackground}" />
										</VisualState.Setters>
									</VisualState>
									<VisualState x:Name="Success">
										<VisualState.StateTriggers>
											<wcttriggers:CompareStateTrigger
												Comparison="Equal"
												Value="{x:Bind StatusNumber}"
												To="1" />
										</VisualState.StateTriggers>
										<VisualState.Setters>
											<Setter Target="ContentRoot.Background" Value="{ThemeResource InfoBarSuccessSeverityBackgroundBrush}" />
											<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource InfoBarSuccessSeverityIconBackground}" />
										</VisualState.Setters>
									</VisualState>
									<VisualState x:Name="Error">
										<VisualState.StateTriggers>
											<wcttriggers:CompareStateTrigger
												Comparison="Equal"
												Value="{x:Bind StatusNumber}"
												To="3" />
										</VisualState.StateTriggers>
										<VisualState.Setters>
											<Setter Target="ContentRoot.Background" Value="{ThemeResource InfoBarErrorSeverityBackgroundBrush}" />
											<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource InfoBarErrorSeverityIconBackground}" />
										</VisualState.Setters>
									</VisualState>
								</VisualStateGroup>
							</VisualStateManager.VisualStateGroups>
						</Grid>
					</UserControl>
				</DataTemplate>
			</ListView.ItemTemplate>

		</ListView>

	</Grid>
</UserControl>
