<!--  Copyright (c) 2023 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<UserControl
	x:Class="Files.App.UserControls.StatusCenter"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:selectors="using:Files.App.Data.TemplateSelectors"
	xmlns:statuscenter="using:Files.App.Utils.StatusCenter"
	xmlns:wctconverters="using:CommunityToolkit.WinUI.UI.Converters"
	xmlns:wcttriggers="using:CommunityToolkit.WinUI.UI.Triggers"
	mc:Ignorable="d">

	<UserControl.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="ms-appx:///ResourceDictionaries/StatusCenterItemExpanderStyle.xaml" />
				<ResourceDictionary>

					<wctconverters:BoolNegationConverter x:Key="BoolNegationConverter" />
					<wctconverters:EmptyCollectionToObjectConverter
						x:Key="EmptyCollectionToBoolConverter"
						EmptyValue="False"
						NotEmptyValue="True" />

					<selectors:StatusCenterItemSelector
						x:Key="StatusCenterItemSelector"
						CardStyleItem="{StaticResource StatusCenterItemCardStyleDataTemplate}"
						ExpanderStyleItem="{StaticResource StatusCenterItemExpanderStyleDataTemplate}" />

					<DataTemplate x:Name="StatusCenterItemExpanderStyleDataTemplate" x:DataType="statuscenter:StatusCenterItem">
						<UserControl>
							<Expander
								x:Name="ContentRoot"
								Padding="16"
								HorizontalAlignment="Stretch"
								AutomationProperties.Name="{x:Bind FullTitle, Mode=OneWay}"
								Background="{StaticResource InfoBarInformationalSeverityBackgroundBrush}"
								BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
								BorderThickness="1"
								CornerRadius="{StaticResource ControlCornerRadius}"
								Style="{StaticResource StatusCenterItemExpanderStyle}">
								<Expander.Header>
									<Grid Padding="16,8,8,8" ColumnSpacing="12">

										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="*" />
											<ColumnDefinition Width="Auto" />
										</Grid.ColumnDefinitions>

										<TextBlock
											x:Name="SeverityBackgroundFontIcon"
											Grid.Column="0"
											VerticalAlignment="Center"
											FontFamily="{ThemeResource SymbolThemeFontFamily}"
											FontSize="16"
											Text="&#xF136;" />

										<TextBlock
											x:Name="SeverityForegroundFontIcon"
											Grid.Column="0"
											VerticalAlignment="Center"
											FontFamily="{ThemeResource SymbolThemeFontFamily}"
											FontSize="16"
											Foreground="{ThemeResource TextFillColorInverseBrush}"
											Text="{x:Bind StateIcon}" />

										<StackPanel Grid.Column="1" VerticalAlignment="Center">

											<TextBlock
												MaxLines="1"
												Style="{StaticResource BodyTextBlockStyle}"
												Text="{x:Bind FullTitle, Mode=OneWay}"
												TextTrimming="CharacterEllipsis"
												TextWrapping="NoWrap" />

											<ProgressBar
												x:Name="ProgressBar"
												Margin="0,8"
												IsIndeterminate="{x:Bind IsCancelled, Mode=OneWay}"
												Visibility="{x:Bind IsProgressing, Mode=OneWay}"
												Value="{x:Bind Progress, Mode=OneWay}" />

											<TextBlock
												Foreground="{ThemeResource TextFillColorSecondaryBrush}"
												MaxLines="1"
												Style="{StaticResource CaptionTextBlockStyle}"
												Text="{x:Bind Message, Mode=OneWay}"
												TextTrimming="CharacterEllipsis"
												TextWrapping="NoWrap" />

										</StackPanel>

										<Grid Grid.Column="2">

											<Button
												x:Name="CancelItemButton"
												Width="32"
												Height="32"
												Padding="0"
												x:Load="{x:Bind CancelButtonVisible}"
												AutomationProperties.Name="{helpers:ResourceString Name=Cancel}"
												Background="Transparent"
												BorderBrush="Transparent"
												Command="{x:Bind CancelCommand}"
												DataContext="{x:Bind}"
												IsEnabled="{x:Bind IsCancelled, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
												ToolTipService.ToolTip="{helpers:ResourceString Name=Cancel}">
												<Button.Content>
													<FontIcon FontSize="16" Glyph="&#xE711;" />
												</Button.Content>
											</Button>

											<Button
												x:Name="CloseItemButton"
												Width="32"
												Height="32"
												Padding="0"
												x:Load="{x:Bind CancelButtonVisible, Converter={StaticResource BoolNegationConverter}}"
												AutomationProperties.Name="{helpers:ResourceString Name=Clear}"
												Background="Transparent"
												BorderBrush="Transparent"
												Click="CloseItemButton_Click"
												ToolTipService.ToolTip="{helpers:ResourceString Name=Clear}">
												<Button.Content>
													<FontIcon FontSize="16" Glyph="&#xE711;" />
												</Button.Content>
											</Button>

										</Grid>
									</Grid>
								</Expander.Header>

								<Expander.Content>
									<ProgressBar
										x:Name="ProgressBar2"
										Margin="0,8"
										IsIndeterminate="{x:Bind IsCancelled, Mode=OneWay}"
										Visibility="{x:Bind IsProgressing, Mode=OneWay}"
										Value="{x:Bind Progress, Mode=OneWay}" />
								</Expander.Content>

								<VisualStateManager.VisualStateGroups>
									<VisualStateGroup>
										<VisualState x:Name="Normal">
											<VisualState.StateTriggers>
												<wcttriggers:CompareStateTrigger
													Comparison="Equal"
													Value="{x:Bind StateNumber}"
													To="0" />
											</VisualState.StateTriggers>
											<VisualState.Setters>
												<Setter Target="ContentRoot.Background" Value="{ThemeResource SystemFillColorAttentionBackgroundBrush}" />
												<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource SystemFillColorAttentionBrush}" />
											</VisualState.Setters>
										</VisualState>
										<VisualState x:Name="Success">
											<VisualState.StateTriggers>
												<wcttriggers:CompareStateTrigger
													Comparison="Equal"
													Value="{x:Bind StateNumber}"
													To="1" />
											</VisualState.StateTriggers>
											<VisualState.Setters>
												<Setter Target="ContentRoot.Background" Value="{ThemeResource SystemFillColorSuccessBackgroundBrush}" />
												<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource SystemFillColorSuccessBrush}" />
											</VisualState.Setters>
										</VisualState>
										<VisualState x:Name="Error">
											<VisualState.StateTriggers>
												<wcttriggers:CompareStateTrigger
													Comparison="Equal"
													Value="{x:Bind StateNumber}"
													To="2" />
											</VisualState.StateTriggers>
											<VisualState.Setters>
												<Setter Target="ContentRoot.Background" Value="{ThemeResource SystemFillColorCriticalBackgroundBrush}" />
												<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource SystemFillColorCriticalBrush}" />
											</VisualState.Setters>
										</VisualState>
									</VisualStateGroup>
								</VisualStateManager.VisualStateGroups>
							</Expander>
						</UserControl>
					</DataTemplate>

					<DataTemplate x:Name="StatusCenterItemCardStyleDataTemplate" x:DataType="statuscenter:StatusCenterItem">
						<UserControl>
							<Grid
								x:Name="ContentRoot"
								Padding="16,8,8,8"
								HorizontalAlignment="Stretch"
								AutomationProperties.Name="{x:Bind FullTitle, Mode=OneWay}"
								Background="{StaticResource InfoBarInformationalSeverityBackgroundBrush}"
								BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
								BorderThickness="1"
								ColumnSpacing="12"
								CornerRadius="{StaticResource ControlCornerRadius}"
								Style="{StaticResource StatusCenterItemExpanderStyle}">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="Auto" />
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="Auto" />
								</Grid.ColumnDefinitions>

								<TextBlock
									x:Name="SeverityBackgroundFontIcon"
									Grid.Column="0"
									VerticalAlignment="Center"
									FontFamily="{ThemeResource SymbolThemeFontFamily}"
									FontSize="16"
									Text="&#xF136;" />

								<TextBlock
									x:Name="SeverityForegroundFontIcon"
									Grid.Column="0"
									VerticalAlignment="Center"
									FontFamily="{ThemeResource SymbolThemeFontFamily}"
									FontSize="16"
									Foreground="{ThemeResource TextFillColorInverseBrush}"
									Text="{x:Bind StateIcon}" />

								<StackPanel Grid.Column="1" VerticalAlignment="Center">

									<TextBlock
										Style="{StaticResource BodyTextBlockStyle}"
										Text="{x:Bind FullTitle, Mode=OneWay}"
										TextTrimming="CharacterEllipsis"
										TextWrapping="NoWrap" />

									<ProgressBar
										x:Name="ProgressBar"
										Margin="0,8"
										IsIndeterminate="{x:Bind IsCancelled, Mode=OneWay}"
										Visibility="{x:Bind IsProgressing, Mode=OneWay}"
										Value="{x:Bind Progress, Mode=OneWay}" />

									<TextBlock
										Foreground="{ThemeResource TextFillColorSecondaryBrush}"
										Style="{StaticResource CaptionTextBlockStyle}"
										Text="{x:Bind Message, Mode=OneWay}"
										TextTrimming="CharacterEllipsis"
										TextWrapping="NoWrap" />

								</StackPanel>

								<Grid Grid.Column="2">

									<Button
										x:Name="CancelItemButton"
										Width="32"
										Height="32"
										Padding="0"
										x:Load="{x:Bind CancelButtonVisible}"
										AutomationProperties.Name="{helpers:ResourceString Name=Cancel}"
										Background="Transparent"
										BorderBrush="Transparent"
										Command="{x:Bind CancelCommand}"
										DataContext="{x:Bind}"
										IsEnabled="{x:Bind IsCancelled, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
										ToolTipService.ToolTip="{helpers:ResourceString Name=Cancel}">
										<Button.Content>
											<FontIcon FontSize="16" Glyph="&#xE711;" />
										</Button.Content>
									</Button>

									<Button
										x:Name="CloseItemButton"
										Width="32"
										Height="32"
										Padding="0"
										x:Load="{x:Bind CancelButtonVisible, Converter={StaticResource BoolNegationConverter}}"
										AutomationProperties.Name="{helpers:ResourceString Name=Clear}"
										Background="Transparent"
										BorderBrush="Transparent"
										Click="CloseItemButton_Click"
										ToolTipService.ToolTip="{helpers:ResourceString Name=Clear}">
										<Button.Content>
											<FontIcon FontSize="16" Glyph="&#xE711;" />
										</Button.Content>
									</Button>

								</Grid>

								<VisualStateManager.VisualStateGroups>
									<VisualStateGroup>
										<VisualState x:Name="Normal">
											<VisualState.StateTriggers>
												<wcttriggers:CompareStateTrigger
													Comparison="Equal"
													Value="{x:Bind StateNumber}"
													To="0" />
											</VisualState.StateTriggers>
											<VisualState.Setters>
												<Setter Target="ContentRoot.Background" Value="{ThemeResource SystemFillColorAttentionBackgroundBrush}" />
												<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource SystemFillColorAttentionBrush}" />
											</VisualState.Setters>
										</VisualState>
										<VisualState x:Name="Success">
											<VisualState.StateTriggers>
												<wcttriggers:CompareStateTrigger
													Comparison="Equal"
													Value="{x:Bind StateNumber}"
													To="1" />
											</VisualState.StateTriggers>
											<VisualState.Setters>
												<Setter Target="ContentRoot.Background" Value="{ThemeResource SystemFillColorSuccessBackgroundBrush}" />
												<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource SystemFillColorSuccessBrush}" />
											</VisualState.Setters>
										</VisualState>
										<VisualState x:Name="Error">
											<VisualState.StateTriggers>
												<wcttriggers:CompareStateTrigger
													Comparison="Equal"
													Value="{x:Bind StateNumber}"
													To="2" />
											</VisualState.StateTriggers>
											<VisualState.Setters>
												<Setter Target="ContentRoot.Background" Value="{ThemeResource SystemFillColorCriticalBackgroundBrush}" />
												<Setter Target="SeverityBackgroundFontIcon.Foreground" Value="{ThemeResource SystemFillColorCriticalBrush}" />
											</VisualState.Setters>
										</VisualState>
									</VisualStateGroup>
								</VisualStateManager.VisualStateGroups>
							</Grid>
						</UserControl>
					</DataTemplate>

				</ResourceDictionary>
			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</UserControl.Resources>

	<Grid Margin="-16">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<!--  Header  -->
		<Grid Padding="12">

			<TextBlock
				VerticalAlignment="Center"
				FontSize="14"
				Style="{StaticResource BodyStrongTextBlockStyle}"
				Text="{helpers:ResourceString Name=OngoingTasks}" />

			<Button
				x:Name="CloseAllItemsButton"
				Height="24"
				Padding="8,0"
				HorizontalAlignment="Right"
				Click="CloseAllItemsButton_Click"
				Content="{helpers:ResourceString Name=ClearAll}"
				FontSize="12"
				IsEnabled="{x:Bind ViewModel.StatusCenterItems, Converter={StaticResource EmptyCollectionToBoolConverter}, Mode=OneWay}" />

		</Grid>

		<!--  Divider  -->
		<Rectangle
			Grid.Row="1"
			Height="1"
			HorizontalAlignment="Stretch"
			Fill="{ThemeResource DividerStrokeColorDefaultBrush}" />

		<!--  Ongoing Tasks List  -->
		<ListView
			x:Name="StatusCenterItemsListView"
			Grid.Row="2"
			Padding="4"
			VerticalAlignment="Stretch"
			ItemTemplateSelector="{StaticResource StatusCenterItemSelector}"
			ItemsSource="{x:Bind ViewModel.StatusCenterItems, Mode=OneWay}"
			ScrollViewer.VerticalScrollBarVisibility="Auto"
			ScrollViewer.VerticalScrollMode="Enabled"
			SelectionMode="None">

			<!--  Item Style  -->
			<ListView.ItemContainerStyle>
				<Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
					<Setter Property="Padding" Value="0,2" />
				</Style>
			</ListView.ItemContainerStyle>

		</ListView>

	</Grid>
</UserControl>
