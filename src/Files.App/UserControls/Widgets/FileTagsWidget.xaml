<!--  Copyright (c) 2023 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<UserControl
	x:Class="Files.App.UserControls.Widgets.FileTagsWidget"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:converters="using:Files.App.Converters"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:dataitems="using:Files.App.Data.Items"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:wctcontrols="using:CommunityToolkit.WinUI.UI.Controls"
	xmlns:wctconverters="using:CommunityToolkit.WinUI.UI.Converters"
	DataContext="{x:Bind ViewModel, Mode=OneWay}"
	mc:Ignorable="d">

	<UserControl.Resources>
		<converters:StringToBrushConverter x:Key="StringToBrushConverter" />
		<converters:ImageModelToImageConverter x:Key="ImageModelToImageConverter" />
		<wctconverters:EmptyCollectionToObjectConverter
			x:Key="EmptyCollectionToBooleanConverter"
			EmptyValue="True"
			NotEmptyValue="False" />
	</UserControl.Resources>

	<ItemsRepeater ItemsSource="{x:Bind ViewModel.Containers, Mode=OneWay}">

		<ItemsRepeater.ItemTemplate>
			<DataTemplate x:DataType="dataitems:WidgetFileTagsContainerItem">
				<Grid
					HorizontalAlignment="Stretch"
					VerticalAlignment="Stretch"
					AllowDrop="True"
					Background="{ThemeResource ControlFillColorDefaultBrush}"
					BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
					BorderThickness="1"
					CornerRadius="{StaticResource ControlCornerRadius}">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>

					<!--  Title  -->
					<Grid
						Background="Transparent"
						BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
						BorderThickness="0,0,0,1">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>

						<!--  View More  -->
						<HyperlinkButton
							Margin="4"
							Padding="4,6"
							AutomationProperties.Name="{helpers:ResourceString Name=ViewMore}"
							Command="{x:Bind ViewMoreCommand}"
							ToolTipService.ToolTip="{helpers:ResourceString Name=ViewMore}">
							<StackPanel Orientation="Horizontal" Spacing="8">

								<!--  Tag Color  -->
								<PathIcon Data="{StaticResource ColorIconFilledTag}" Foreground="{x:Bind Color, Mode=OneWay, Converter={StaticResource StringToBrushConverter}}" />

								<!--  Tag Name  -->
								<TextBlock
									Margin="0,-2,0,0"
									FontWeight="SemiBold"
									Foreground="{ThemeResource TextFillColorPrimaryBrush}"
									Text="{x:Bind Name, Mode=OneWay}" />

							</StackPanel>
						</HyperlinkButton>

						<!--  Additional Actions  -->
						<Button
							Grid.Column="2"
							Width="36"
							Height="32"
							Margin="4"
							Padding="0"
							Background="Transparent"
							BorderBrush="Transparent"
							ToolTipService.ToolTip="{helpers:ResourceString Name=MoreOptions}">

							<Button.Flyout>
								<MenuFlyout>
									<MenuFlyoutItem
										x:Name="OpenAllItemsButton"
										AutomationProperties.Name="{helpers:ResourceString Name=OpenAllTaggedItems}"
										Command="{x:Bind OpenAllCommand}"
										Text="{helpers:ResourceString Name=OpenAllTaggedItems}"
										ToolTipService.ToolTip="{helpers:ResourceString Name=OpenAllTaggedItems}">
										<MenuFlyoutItem.Icon>
											<FontIcon Glyph="&#xE8A7;" />
										</MenuFlyoutItem.Icon>
									</MenuFlyoutItem>
								</MenuFlyout>
							</Button.Flyout>

							<FontIcon Foreground="{ThemeResource TextFillColorSecondaryBrush}" Glyph="&#xE712;" />

						</Button>
					</Grid>

					<!--  Container Items  -->
					<!--  NOTE: The Vertical ScrollBar Must Be Hidden Because It May Cause A Crash Inside The ScrollViewer (#12370)  -->
					<wctcontrols:AdaptiveGridView
						Grid.Row="1"
						Padding="4"
						HorizontalAlignment="Stretch"
						DesiredWidth="180"
						IsItemClickEnabled="True"
						ItemClick="FileTagsContainerAdaptiveGridView_ItemClick"
						ItemsSource="{x:Bind Tags}"
						RightTapped="FileTagsContainerAdaptiveGridView_RightTapped"
						ScrollViewer.VerticalScrollBarVisibility="Hidden"
						SelectionMode="None"
						StretchContentForSingleRow="False">

						<wctcontrols:AdaptiveGridView.ItemTemplate>
							<DataTemplate x:DataType="dataitems:WidgetFileTagsItem">
								<Grid
									ColumnSpacing="8"
									DataContext="{x:Bind}"
									ToolTipService.ToolTip="{x:Bind Path}">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition Width="*" />
									</Grid.ColumnDefinitions>

									<!--  Thumbnail  -->
									<Image
										Grid.Column="0"
										Width="20"
										Height="20"
										VerticalAlignment="Center"
										Source="{x:Bind Icon, Mode=OneWay, Converter={StaticResource ImageModelToImageConverter}}" />

									<!--  Name  -->
									<TextBlock
										Grid.Column="1"
										VerticalAlignment="Center"
										Text="{x:Bind Name, Mode=OneWay}"
										TextTrimming="CharacterEllipsis" />

								</Grid>
							</DataTemplate>
						</wctcontrols:AdaptiveGridView.ItemTemplate>

						<wctcontrols:AdaptiveGridView.ItemContainerStyle>
							<Style BasedOn="{StaticResource DefaultGridViewItemStyle}" TargetType="GridViewItem">
								<Setter Property="Padding" Value="8,0" />
								<Setter Property="MinHeight" Value="{ThemeResource ListItemHeight}" />
							</Style>
						</wctcontrols:AdaptiveGridView.ItemContainerStyle>

					</wctcontrols:AdaptiveGridView>

					<TextBlock
						Grid.RowSpan="2"
						HorizontalAlignment="Center"
						VerticalAlignment="Center"
						x:Load="{x:Bind Tags, Converter={StaticResource EmptyCollectionToBooleanConverter}, Mode=OneWay}"
						Foreground="{ThemeResource TextFillColorSecondaryBrush}"
						Style="{StaticResource CaptionTextBlockStyle}"
						Text="{helpers:ResourceString Name=NoTaggedItems}" />

				</Grid>
			</DataTemplate>
		</ItemsRepeater.ItemTemplate>

		<ItemsRepeater.Layout>
			<UniformGridLayout
				ItemsStretch="Fill"
				MaximumRowsOrColumns="6"
				MinColumnSpacing="8"
				MinItemHeight="260"
				MinItemWidth="220"
				MinRowSpacing="8"
				Orientation="Horizontal" />
		</ItemsRepeater.Layout>

	</ItemsRepeater>
</UserControl>
