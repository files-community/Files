<!--  Copyright (c) 2023 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<local:BaseTabView
	x:Class="Files.App.UserControls.TabView.TabView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:local="using:Files.App.UserControls.TabView"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:root="using:Files.App"
	mc:Ignorable="d">

	<local:BaseTabView.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary>

					<!--  TabView Item MenuFlyout  -->
					<MenuFlyout
						x:Key="TabFlyout"
						x:Name="TabItemContextMenu"
						Closing="TabItemContextMenu_Closing"
						Opening="TabItemContextMenu_Opening">
						<MenuFlyoutItem
							Command="{x:Bind Commands.NewTab}"
							KeyboardAcceleratorTextOverride="{x:Bind Commands.NewTab.HotKeyText, Mode=OneWay}"
							Text="{x:Bind Commands.NewTab.Label}" />
						<MenuFlyoutItem
							Command="{x:Bind Commands.DuplicateSelectedTab}"
							KeyboardAcceleratorTextOverride="{x:Bind Commands.DuplicateSelectedTab.HotKeyText, Mode=OneWay}"
							Text="{x:Bind Commands.DuplicateSelectedTab.Label}" />
						<MenuFlyoutItem
							x:Name="MenuItemMoveTabToNewWindow"
							Click="MoveTabToNewWindow"
							Text="{helpers:ResourceString Name=HorizontalMultitaskingControlMoveTabToNewWindow/Text}">
							<MenuFlyoutItem.Icon>
								<FontIcon Glyph="&#xE8A7;" />
							</MenuFlyoutItem.Icon>
						</MenuFlyoutItem>
						<MenuFlyoutItem
							Command="{x:Bind Commands.CloseTabsToTheLeftSelected}"
							KeyboardAcceleratorTextOverride="{x:Bind Commands.CloseTabsToTheLeftSelected.HotKeyText, Mode=OneWay}"
							Text="{x:Bind Commands.CloseTabsToTheLeftSelected.Label}" />
						<MenuFlyoutItem
							Command="{x:Bind Commands.CloseTabsToTheRightSelected}"
							KeyboardAcceleratorTextOverride="{x:Bind Commands.CloseTabsToTheRightSelected.HotKeyText, Mode=OneWay}"
							Text="{x:Bind Commands.CloseTabsToTheRightSelected.Label}" />
						<MenuFlyoutItem
							Command="{x:Bind Commands.CloseOtherTabsSelected}"
							KeyboardAcceleratorTextOverride="{x:Bind Commands.CloseOtherTabsSelected.HotKeyText, Mode=OneWay}"
							Text="{x:Bind Commands.CloseOtherTabsSelected.Label}" />
						<MenuFlyoutItem
							Command="{x:Bind Commands.ReopenClosedTab}"
							IsEnabled="{x:Bind Commands.ReopenClosedTab.IsExecutable}"
							KeyboardAcceleratorTextOverride="{x:Bind Commands.ReopenClosedTab.HotKeyText, Mode=OneWay}"
							Text="{x:Bind Commands.ReopenClosedTab.Label}" />
					</MenuFlyout>

				</ResourceDictionary>

				<ResourceDictionary Source="ms-appx:///ResourceDictionaries/TabViewItemStyles.xaml" />

			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</local:BaseTabView.Resources>

	<Border
		x:Name="RootLayout"
		HorizontalAlignment="Stretch"
		x:FieldModifier="public"
		Background="Transparent">
		<TabView
			x:Name="HorizontalTabView"
			Margin="0,10,0,0"
			Padding="0"
			VerticalAlignment="Stretch"
			AddTabButtonClick="TabView_AddTabButtonClick"
			AllowDropTabs="True"
			CanDragTabs="True"
			DragLeave="TabStrip_DragLeave"
			IsAddTabButtonVisible="False"
			SelectedIndex="{x:Bind root:App.AppModel.TabStripSelectedIndex, Mode=TwoWay}"
			SelectionChanged="TabStrip_SelectionChanged"
			TabCloseRequested="TabStrip_TabCloseRequested"
			TabDragCompleted="TabStrip_TabDragCompleted"
			TabDragStarting="TabStrip_TabDragStarting"
			TabDroppedOutside="TabStrip_TabDroppedOutside"
			TabItemsChanged="HorizontalTabView_TabItemsChanged"
			TabItemsSource="{x:Bind Items, Mode=OneWay}"
			TabStripDragOver="TabStrip_TabStripDragOver"
			TabStripDrop="TabStrip_TabStripDrop"
			Visibility="{x:Bind TabStripVisibility, Mode=OneWay}">

			<TabView.TabItemTemplate>
				<DataTemplate x:DataType="local:TabItem">
					<TabViewItem
						AllowDrop="{x:Bind AllowStorageItemDrop, Mode=OneWay}"
						ContextFlyout="{StaticResource TabFlyout}"
						DragEnter="TabViewItem_DragEnter"
						DragLeave="TabViewItem_DragLeave"
						Drop="TabViewItem_Drop"
						Header="{x:Bind Header, Mode=OneWay}"
						IconSource="{x:Bind IconSource, Mode=OneWay}"
						Loaded="TabViewItem_Loaded"
						Style="{StaticResource CustomTabViewItemStyle}"
						ToolTipService.ToolTip="{x:Bind ToolTipText, Mode=OneWay}" />
				</DataTemplate>
			</TabView.TabItemTemplate>

			<TabView.TabStripFooter>
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
						<ColumnDefinition x:Name="RightPaddingColumn" Width="0" />
					</Grid.ColumnDefinitions>
					<ContentPresenter Grid.Column="0" Content="{x:Bind ActionsControl, Mode=OneWay}" />

					<!--  The Drag Area For The Title Bar  -->
					<Rectangle
						x:Name="DragAreaRectangle"
						Grid.Column="1"
						Grid.ColumnSpan="2"
						HorizontalAlignment="Stretch"
						VerticalAlignment="Stretch"
						Fill="Transparent" />

				</Grid>
			</TabView.TabStripFooter>

		</TabView>
	</Border>
</local:BaseTabView>
