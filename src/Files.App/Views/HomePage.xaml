<!--  Copyright (c) 2023 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<Page
	x:Class="Files.App.Views.HomePage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:dataitems="using:Files.App.Data.Items"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:i="using:Microsoft.Xaml.Interactivity"
	xmlns:icore="using:Microsoft.Xaml.Interactions.Core"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	DataContext="{x:Bind HomeViewModel, Mode=OneWay}"
	mc:Ignorable="d">

	<i:Interaction.Behaviors>
		<icore:EventTriggerBehavior EventName="Loaded">
			<icore:InvokeCommandAction Command="{x:Bind HomeViewModel.LoadWidgetsCommand, Mode=OneWay}" />
		</icore:EventTriggerBehavior>
	</i:Interaction.Behaviors>

	<UserControl.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="ms-appx:///ResourceDictionaries/WidgetContainerStyles.xaml" />
			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</UserControl.Resources>

	<!--  Widget List  -->
	<ScrollViewer>
		<ListView ItemsSource="{x:Bind HomeViewModel.WidgetItems, Mode=OneWay}" SelectionMode="None">

			<ListView.ItemTemplate>
				<DataTemplate x:DataType="dataitems:WidgetContainerItem">
					<Grid>

						<Expander
							Padding="16,0,16,0"
							HorizontalAlignment="Stretch"
							HorizontalContentAlignment="Stretch"
							AutomationProperties.Name="{x:Bind WidgetAutomationProperties, Mode=OneWay}"
							IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}">

							<Expander.Header>
								<TextBlock
									FontWeight="SemiBold"
									Foreground="{ThemeResource TextFillColorSecondaryBrush}"
									Style="{StaticResource App.Theme.CaptionTextBlockStyle}"
									Text="{x:Bind WidgetItemModel.WidgetHeader, Mode=OneWay}" />
							</Expander.Header>

							<ContentControl
								HorizontalAlignment="Stretch"
								HorizontalContentAlignment="Stretch"
								Content="{x:Bind WidgetControl, Mode=OneWay}" />

							<Expander.Resources>
								<SolidColorBrush x:Key="ExpanderHeaderBackground" Color="Transparent" />
								<SolidColorBrush x:Key="ExpanderHeaderBorderBrush" Color="Transparent" />
								<SolidColorBrush x:Key="ExpanderHeaderBorderPointerOverBrush" Color="Transparent" />
								<SolidColorBrush x:Key="ExpanderHeaderBorderPressedBrush" Color="Transparent" />
								<SolidColorBrush x:Key="ExpanderContentBackground" Color="Transparent" />
								<SolidColorBrush x:Key="ExpanderContentBorderBrush" Color="Transparent" />
							</Expander.Resources>

						</Expander>

						<!--  Menu Flyout  -->
						<Button
							x:Name="MenuFlyout"
							Width="36"
							Height="32"
							Margin="0,8,16,0"
							Padding="0"
							HorizontalAlignment="Right"
							VerticalAlignment="Top"
							x:Load="{x:Bind ShowMenuFlyout, Mode=OneWay}"
							AutomationProperties.Name="{helpers:ResourceString Name=MoreOptions}"
							Background="Transparent"
							BorderBrush="Transparent"
							ToolTipService.ToolTip="{helpers:ResourceString Name=MoreOptions}">

							<FontIcon
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								FontSize="14"
								Foreground="{ThemeResource TextFillColorSecondaryBrush}"
								Glyph="&#xE712;" />

							<Button.Flyout>
								<MenuFlyout>
									<MenuFlyoutItem
										x:Name="FlyoutItem"
										Command="{x:Bind MenuFlyoutItem.Command}"
										Icon="{x:Bind MenuFlyoutItem.Icon}"
										Text="{x:Bind MenuFlyoutItem.Text}" />
								</MenuFlyout>
							</Button.Flyout>

						</Button>

					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>

			<ListView.ItemContainerStyle>
				<Style TargetType="ListViewItem">
					<Setter Property="Margin" Value="0,4" />
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate TargetType="ListViewItem">
								<ListViewItemPresenter
									x:Name="Root"
									HorizontalContentAlignment="Stretch"
									VerticalContentAlignment="Stretch" />
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</Style>
			</ListView.ItemContainerStyle>

		</ListView>
	</ScrollViewer>

</Page>
