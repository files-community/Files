<!--  Copyright (c) 2024 Files Community. Licensed under the MIT License. See the LICENSE.  -->
<Page
	x:Class="Files.App.Views.Settings.ActionsPage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:core="using:Microsoft.Xaml.Interactions.Core"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:dataitems="using:Files.App.Data.Items"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:i="using:Microsoft.Xaml.Interactivity"
	xmlns:keyboard="using:Files.App.UserControls.KeyboardShortcut"
	xmlns:local="using:Files.App.UserControls.Settings"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm="using:Files.App.ViewModels.Settings"
	xmlns:wctconverters="using:CommunityToolkit.WinUI.UI.Converters"
	mc:Ignorable="d">

	<Page.Resources>
		<ResourceDictionary>
			<ResourceDictionary.ThemeDictionaries>
				<ResourceDictionary x:Key="Light">
					<StaticResource x:Key="OutlinedStyleBackgroundBrush" ResourceKey="ControlFillColorTransparentBrush" />
				</ResourceDictionary>
				<ResourceDictionary x:Key="Dark">
					<StaticResource x:Key="OutlinedStyleBackgroundBrush" ResourceKey="ControlFillColorSecondaryBrush" />
				</ResourceDictionary>
				<ResourceDictionary x:Key="HighContrast">
					<StaticResource x:Key="OutlinedStyleBackgroundBrush" ResourceKey="ControlFillColorTransparentBrush" />
				</ResourceDictionary>
			</ResourceDictionary.ThemeDictionaries>

			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="/ResourceDictionaries/RightAlignedToggleSwitchStyle.xaml" />
				<ResourceDictionary Source="ms-appx:///UserControls/KeyboardShortcut/KeyboardShortcut.xaml" />
			</ResourceDictionary.MergedDictionaries>

			<wctconverters:BoolNegationConverter x:Key="BoolNegationConverter" />
			<wctconverters:EmptyObjectToObjectConverter
				x:Key="NullToBooleanConverter"
				EmptyValue="False"
				NotEmptyValue="True" />
			<wctconverters:EmptyObjectToObjectConverter
				x:Key="NullToNegateBooleanConverter"
				EmptyValue="True"
				NotEmptyValue="False" />
			<wctconverters:BoolToVisibilityConverter
				x:Key="NegationBoolToVisibilityConverter"
				FalseValue="Visible"
				TrueValue="Collapsed" />

		</ResourceDictionary>
	</Page.Resources>

	<Page.DataContext>
		<vm:ActionsViewModel x:Name="ViewModel" />
	</Page.DataContext>

	<Grid>
		<StackPanel
			HorizontalAlignment="Stretch"
			VerticalAlignment="Stretch"
			Spacing="4">
			<StackPanel.ChildrenTransitions>
				<TransitionCollection>
					<EntranceThemeTransition />
				</TransitionCollection>
			</StackPanel.ChildrenTransitions>

			<!--  Title  -->
			<TextBlock
				Padding="0,0,0,12"
				FontSize="24"
				FontWeight="Medium"
				Text="Actions" />

			<!--  Subtitle  -->
			<Grid ColumnSpacing="12">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<TextBlock
					Margin="0,8,0,4"
					FontSize="16"
					FontWeight="Medium"
					Text="Commands" />

				<!--  Add New Button  -->
				<Button
					x:Name="ShowAddNewGridButton"
					Grid.Column="1"
					Command="{x:Bind ViewModel.ShowAddNewShortcutGridCommand, Mode=OneWay}"
					Content="Add command"
					IsEnabled="{x:Bind ViewModel.SelectedNewShortcutItem, Converter={StaticResource NullToNegateBooleanConverter}, Mode=OneWay}" />

				<!--  Reset All Button  -->
				<Button
					x:Name="ResetAllButton"
					Grid.Column="2"
					Command="{x:Bind ViewModel.ShowResetAllConfirmationCommand, Mode=OneWay}"
					Content="Restore defaults" />
			</Grid>

			<!--  Add New  -->
			<Grid
				x:Name="CreateNewSectionGrid"
				Height="60"
				Margin="0,4,0,0"
				Padding="16,12"
				x:Load="{x:Bind ViewModel.ShowAddNewShortcutGrid, Mode=OneWay}"
				Background="{ThemeResource ExpanderHeaderBackground}"
				BorderBrush="{ThemeResource ExpanderHeaderBorderBrush}"
				BorderThickness="1"
				ColumnSpacing="12"
				CornerRadius="{StaticResource ControlCornerRadius}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="32" />
					<ColumnDefinition Width="32" />
				</Grid.ColumnDefinitions>

				<ComboBox
					x:Name="NewShortcutItemPickerComboBox"
					Padding="0"
					ItemsSource="{x:Bind ViewModel.ExcludedKeyboardShortcuts, Mode=OneWay}"
					PlaceholderText="Pick an action"
					SelectedItem="{x:Bind ViewModel.SelectedNewShortcutItem, Mode=TwoWay}">
					<ComboBox.ItemTemplate>
						<DataTemplate x:DataType="dataitems:RichCommandShortcutItem">
							<StackPanel>
								<TextBlock Style="{StaticResource BodyTextBlockStyle}" Text="{x:Bind Label}" />
								<TextBlock
									Foreground="{ThemeResource TextFillColorSecondaryBrush}"
									Style="{StaticResource CaptionTextBlockStyle}"
									Text="{x:Bind Description}" />
							</StackPanel>
						</DataTemplate>
					</ComboBox.ItemTemplate>
					<ComboBox.Resources>
						<StaticResource x:Key="ComboBoxBackground" ResourceKey="ControlFillColorTransparentBrush" />
						<StaticResource x:Key="ComboBoxBackgroundPointerOver" ResourceKey="ControlFillColorTransparentBrush" />
						<StaticResource x:Key="ComboBoxBackgroundPressed" ResourceKey="ControlFillColorTransparentBrush" />
						<StaticResource x:Key="ComboBoxBackgroundDisabled" ResourceKey="ControlFillColorTransparentBrush" />

						<StaticResource x:Key="ComboBoxBorderBrush" ResourceKey="ControlFillColorTransparentBrush" />
						<StaticResource x:Key="ComboBoxBorderBrushPointerOver" ResourceKey="ControlFillColorTransparentBrush" />
						<StaticResource x:Key="ComboBoxBorderBrushPressed" ResourceKey="ControlFillColorTransparentBrush" />
						<StaticResource x:Key="ComboBoxBorderBrushDisabled" ResourceKey="ControlFillColorTransparentBrush" />
					</ComboBox.Resources>
				</ComboBox>

				<!--  Editor (Using PreviewKeyDown to prevent Ctrl+A)  -->
				<TextBox
					x:Name="KeyboardShortcutEditorTextBox"
					Grid.Column="1"
					Width="144"
					VerticalAlignment="Center"
					IsEnabled="{x:Bind ViewModel.SelectedNewShortcutItem, Converter={StaticResource NullToBooleanConverter}, Mode=OneWay}"
					IsReadOnly="True"
					IsSpellCheckEnabled="False"
					IsTabStop="True"
					PreviewKeyDown="EditorTextBox_PreviewKeyDown"
					Text="{x:Bind ViewModel.SelectedNewShortcutItem.HotKeyText, Mode=TwoWay}"
					TextAlignment="Right" />

				<!--  Add Button  -->
				<Button
					x:Name="AddNewButton"
					Grid.Column="2"
					Width="32"
					Height="32"
					Padding="0"
					Command="{x:Bind ViewModel.AddNewShortcutGridCommand, Mode=OneWay}"
					IsEnabled="{x:Bind ViewModel.SelectedNewShortcutItem, Converter={StaticResource NullToBooleanConverter}, Mode=OneWay}"
					ToolTipService.ToolTip="Add">
					<FontIcon FontSize="14" Glyph="&#xE73E;" />
				</Button>

				<!--  Delete Button  -->
				<Button
					x:Name="DeleteButton"
					Grid.Column="3"
					Width="32"
					Height="32"
					Padding="0"
					Command="{x:Bind ViewModel.HideAddNewShortcutGridCommand, Mode=OneWay}"
					ToolTipService.ToolTip="Delete">
					<FontIcon FontSize="14" Glyph="&#xE711;" />
				</Button>

			</Grid>

			<Border
				x:Name="CreateNewSectionGridDividerBorder"
				Height="1"
				Margin="0,4"
				x:Load="{x:Bind ViewModel.ShowAddNewShortcutGrid, Mode=OneWay}"
				Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

			<ListView
				x:Name="KeyboardShortcutsListView"
				ItemsSource="{x:Bind ViewModel.KeyboardShortcuts, Mode=OneWay}"
				ScrollViewer.HorizontalScrollBarVisibility="Hidden"
				ScrollViewer.HorizontalScrollMode="Disabled"
				ScrollViewer.VerticalScrollBarVisibility="Hidden"
				ScrollViewer.VerticalScrollMode="Disabled"
				SelectionMode="None">
				<ListView.ItemTemplate>
					<DataTemplate x:DataType="dataitems:RichCommandShortcutItem">
						<UserControl PointerEntered="RootGrid_PointerEntered" PointerExited="RootGrid_PointerExited">
							<Grid
								x:Name="RootGrid"
								Height="64"
								Padding="16,12"
								Background="{ThemeResource ExpanderHeaderBackground}"
								BorderBrush="{ThemeResource ExpanderHeaderBorderBrush}"
								BorderThickness="1"
								ColumnSpacing="12"
								CornerRadius="{StaticResource ControlCornerRadius}">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="Auto" />
									<ColumnDefinition Width="32" />
									<ColumnDefinition Width="32" />
								</Grid.ColumnDefinitions>

								<!--  Title & Description  -->
								<StackPanel Spacing="2">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock
											Style="{StaticResource BodyTextBlockStyle}"
											Text="{x:Bind Label}"
											TextTrimming="CharacterEllipsis"
											TextWrapping="NoWrap" />
										<Border
											x:Name="CustomizedIndicatorCircleBorder"
											Width="8"
											Height="8"
											x:Load="{x:Bind IsCustomized, Mode=OneWay}"
											Background="{ThemeResource SystemAccentColor}"
											CornerRadius="{StaticResource ControlCornerRadius}"
											ToolTipService.ToolTip="Customized" />
									</StackPanel>
									<TextBlock
										Foreground="{ThemeResource TextFillColorSecondaryBrush}"
										Style="{StaticResource CaptionTextBlockStyle}"
										Text="{x:Bind Description}"
										TextTrimming="CharacterEllipsis"
										TextWrapping="NoWrap" />
								</StackPanel>

								<!--  Keyboard Shortcut Control  -->
								<keyboard:KeyboardShortcut
									x:Name="RightAlignedKeyboardShortcut"
									Grid.Column="1"
									HorizontalAlignment="Right"
									VerticalAlignment="Center"
									HotKeys="{x:Bind HotKeys, Mode=OneWay}"
									Visibility="{x:Bind IsEditMode, Converter={StaticResource NegationBoolToVisibilityConverter}, Mode=OneWay}" />

								<!--  Editor (Using PreviewKeyDown to prevent Ctrl+A)  -->
								<TextBox
									x:Name="KeyboardShortcutEditorTextBox"
									Grid.Column="1"
									Width="144"
									VerticalAlignment="Center"
									x:Load="{x:Bind IsEditMode, Mode=OneWay}"
									IsReadOnly="True"
									IsSpellCheckEnabled="False"
									IsTabStop="True"
									PreviewKeyDown="EditorTextBox_PreviewKeyDown"
									Text="{x:Bind HotKeyText, Mode=TwoWay}"
									TextAlignment="Right" />

								<!--  Edit Button  -->
								<Button
									x:Name="EditButton"
									Grid.Column="2"
									Width="32"
									Height="32"
									Padding="0"
									x:Load="{x:Bind IsEditMode, Converter={StaticResource BoolNegationConverter}, Mode=OneWay}"
									Click="EditButton_Click"
									ToolTipService.ToolTip="Edit"
									Visibility="Collapsed">
									<FontIcon FontSize="14" Glyph="&#xE70F;" />
								</Button>

								<!--  Save Button  -->
								<Button
									x:Name="SaveButton"
									Grid.Column="2"
									Width="32"
									Height="32"
									Padding="0"
									x:Load="{x:Bind IsEditMode, Mode=OneWay}"
									Click="SaveButton_Click"
									ToolTipService.ToolTip="Save">
									<FontIcon FontSize="14" Glyph="&#xE73E;" />
								</Button>

								<!--  Reset Button  -->
								<Button
									x:Name="ResetButton"
									Grid.Column="3"
									Width="32"
									Height="32"
									Padding="0"
									x:Load="{x:Bind IsEditMode, Mode=OneWay}"
									Click="ResetButton_Click"
									IsEnabled="{x:Bind IsCustomized, Mode=OneWay}"
									ToolTipService.ToolTip="Reset">
									<FontIcon FontSize="14" Glyph="&#xE7A7;" />
								</Button>

								<VisualStateManager.VisualStateGroups>
									<VisualStateGroup x:Name="CommonStates">
										<VisualState x:Name="Normal" />
										<VisualState x:Name="PointerOver">
											<VisualState.Setters>
												<Setter Target="RootGrid.Background" Value="{ThemeResource ButtonBackgroundPointerOver}" />
												<Setter Target="RootGrid.BorderBrush" Value="{ThemeResource ButtonBorderBrushPointerOver}" />
											</VisualState.Setters>
										</VisualState>
									</VisualStateGroup>
								</VisualStateManager.VisualStateGroups>
							</Grid>
						</UserControl>
					</DataTemplate>
				</ListView.ItemTemplate>

				<ListView.ItemContainerStyle>
					<Style TargetType="ListViewItem">
						<Setter Property="Margin" Value="0,2" />
						<Setter Property="Padding" Value="0" />
						<Setter Property="MinHeight" Value="48" />
						<Setter Property="VerticalAlignment" Value="Center" />
						<Setter Property="HorizontalAlignment" Value="Stretch" />
						<Setter Property="HorizontalContentAlignment" Value="Stretch" />
					</Style>
				</ListView.ItemContainerStyle>

			</ListView>
		</StackPanel>

		<TeachingTip
			x:Name="ResetAllConfirmationTeachingTip"
			Width="300"
			ActionButtonCommand="{x:Bind ViewModel.ResetAllCommand, Mode=OneWay}"
			ActionButtonContent="{helpers:ResourceString Name=Yes}"
			ActionButtonStyle="{ThemeResource AccentButtonStyle}"
			CloseButtonContent="{helpers:ResourceString Name=No}"
			IsLightDismissEnabled="True"
			IsOpen="{x:Bind ViewModel.IsResetAllConfirmationTeachingTipOpened, Mode=TwoWay}"
			PreferredPlacement="BottomRight"
			Subtitle="Are you sure you want to reset all custom key binds? This cannot be undone."
			Target="{x:Bind ResetAllButton}" />

		<TeachingTip
			x:Name="AlreadyUsedTeachingTip"
			CloseButtonContent="OK"
			IsLightDismissEnabled="True"
			IsOpen="{x:Bind ViewModel.IsAlreadyUsedTeachingTipOpened, Mode=TwoWay}"
			PreferredPlacement="BottomRight"
			Subtitle="This key bind is used already. Change to another." />

	</Grid>
</Page>
