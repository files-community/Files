<!--  Copyright (c) Files Community. Licensed under the MIT License.  -->
<Page
	x:Class="Files.App.Views.Settings.DevToolsPage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:converters="using:CommunityToolkit.WinUI.Converters"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:helpers="using:Files.App.Helpers"
	xmlns:i="using:Microsoft.Xaml.Interactivity"
	xmlns:local="using:Files.App.UserControls.Settings"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:uc="using:Files.App.UserControls"
	xmlns:vm="using:Files.App.ViewModels.Settings"
	xmlns:wctconverters="using:CommunityToolkit.WinUI.UI.Converters"
	mc:Ignorable="d">

	<Page.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="/Styles/ToggleSwitchStyles.xaml" />
			</ResourceDictionary.MergedDictionaries>

			<converters:BoolNegationConverter x:Key="BoolNegationConverter" />
			<wctconverters:BoolToVisibilityConverter
				x:Key="BoolVisibilityConverter"
				FalseValue="Collapsed"
				TrueValue="Visible" />
			<wctconverters:BoolToVisibilityConverter
				x:Key="InvertedBoolVisibilityConverter"
				FalseValue="Visible"
				TrueValue="Collapsed" />
		</ResourceDictionary>
	</Page.Resources>

	<Page.DataContext>
		<vm:DevToolsViewModel x:Name="ViewModel" />
	</Page.DataContext>

	<Grid>
		<StackPanel
			HorizontalAlignment="Stretch"
			VerticalAlignment="Stretch"
			Spacing="4">

			<!--  Title  -->
			<TextBlock
				Padding="0,0,0,12"
				FontSize="24"
				FontWeight="Medium"
				Text="{helpers:ResourceString Name=DevTools}" />

			<!--  Display Open IDE status bar button  -->
			<local:SettingsBlockControl Title="{helpers:ResourceString Name=DisplayOpenIDE}" HorizontalAlignment="Stretch">
				<local:SettingsBlockControl.Icon>
					<FontIcon Glyph="&#xE7AC;" />
				</local:SettingsBlockControl.Icon>
				<uc:ComboBoxEx
					AutomationProperties.Name="{helpers:ResourceString Name=DisplayOpenIDE}"
					ItemsSource="{x:Bind ViewModel.OpenInIDEOptions.Values}"
					SelectedItem="{x:Bind ViewModel.SelectedOpenInIDEOption, Mode=TwoWay}" />
				<local:SettingsBlockControl.ExpandableContent>
					<Grid
						x:Name="IDEConfigGrid"
						Padding="32,12"
						ColumnSpacing="16">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBlock
							x:Name="TagName"
							MaxWidth="200"
							VerticalAlignment="Center"
							LineHeight="18"
							Text="{helpers:ResourceString Name=DefaultIDE}"
							TextTrimming="CharacterEllipsis" />

						<StackPanel
							Grid.Column="1"
							Orientation="Horizontal"
							Spacing="8"
							Visibility="{x:Bind ViewModel.IsEditingIDEConfig, Converter={StaticResource BoolVisibilityConverter}, Mode=OneWay}">
							<TextBox
								x:Name="IDEFriendlyNameTextBox"
								Width="200"
								VerticalAlignment="Center"
								Text="{x:Bind ViewModel.IDEFriendlyName, Mode=TwoWay}"
								Visibility="{x:Bind ViewModel.IsEditingIDEConfig, Converter={StaticResource BoolVisibilityConverter}, Mode=OneWay}">
								<TextBox.Resources>
									<SolidColorBrush x:Key="TextControlBackgroundFocused" Color="{ThemeResource SolidBackgroundFillColorSecondary}" />
								</TextBox.Resources>
							</TextBox>

							<Button
								x:Name="PickIDEExe"
								Grid.Column="1"
								Command="{x:Bind ViewModel.OpenFilePickerForIDECommand, Mode=OneWay}"
								CommandParameter="{x:Bind XamlRoot, Mode=OneWay}"
								Content="{helpers:ResourceString Name=Browse}" />
						</StackPanel>

						<Button
							x:Name="EditIDEConfigButton"
							Grid.Column="2"
							Padding="8,4"
							Background="Transparent"
							BorderBrush="Transparent"
							Command="{x:Bind ViewModel.StartEditingIDECommand, Mode=OneWay}"
							Content="{helpers:ResourceString Name=Edit}"
							Visibility="{x:Bind ViewModel.IsEditingIDEConfig, Converter={StaticResource InvertedBoolVisibilityConverter}, Mode=OneWay}" />

						<StackPanel
							Grid.Column="2"
							Orientation="Horizontal"
							Spacing="12"
							Visibility="{x:Bind ViewModel.IsEditingIDEConfig, Converter={StaticResource BoolVisibilityConverter}, Mode=OneWay}">
							<Grid
								Padding="12,4"
								VerticalAlignment="Stretch"
								Background="{ThemeResource SystemFillColorCriticalBackgroundBrush}"
								BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
								BorderThickness="1"
								ColumnSpacing="8"
								CornerRadius="4"
								ToolTipService.ToolTip="{helpers:ResourceString Name=ErrorInputEmpty}"
								Visibility="{x:Bind ViewModel.CanSaveIDEChanges, Mode=OneWay, Converter={StaticResource InvertedBoolVisibilityConverter}}">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="Auto" />
									<ColumnDefinition Width="Auto" />
								</Grid.ColumnDefinitions>
								<TextBlock
									VerticalAlignment="Center"
									AutomationProperties.AccessibilityView="Raw"
									FontFamily="{ThemeResource SymbolThemeFontFamily}"
									FontSize="{StaticResource InfoBarIconFontSize}"
									Foreground="{ThemeResource InfoBarErrorSeverityIconBackground}"
									Text="{StaticResource InfoBarIconBackgroundGlyph}" />
								<TextBlock
									VerticalAlignment="Center"
									FontFamily="{ThemeResource SymbolThemeFontFamily}"
									FontSize="{StaticResource InfoBarIconFontSize}"
									Foreground="{ThemeResource InfoBarInformationalSeverityIconForeground}"
									Text="{StaticResource InfoBarErrorIconGlyph}" />
								<TextBlock
									Grid.Column="1"
									VerticalAlignment="Center"
									Text="{helpers:ResourceString Name=InvalidTagNameWarning}" />
							</Grid>

							<!--  Cancel  -->
							<Button Command="{x:Bind ViewModel.CancelIDEChangesCommand, Mode=OneWay}" Content="{helpers:ResourceString Name=Cancel}" />

							<!--  Save Changes  -->
							<Button
								Command="{x:Bind ViewModel.SaveIDEChangesCommand, Mode=OneWay}"
								Content="{helpers:ResourceString Name=Save}"
								IsEnabled="{x:Bind ViewModel.CanSaveIDEChanges, Mode=OneWay}"
								Style="{StaticResource AccentButtonStyle}" />
						</StackPanel>
					</Grid>
				</local:SettingsBlockControl.ExpandableContent>
			</local:SettingsBlockControl>

			<!--  Connect to GitHub  -->
			<local:SettingsBlockControl
				x:Name="ConnectToGitHubSection"
				Title="{helpers:ResourceString Name=ConnectToGitHub}"
				HorizontalAlignment="Stretch"
				x:Load="{x:Bind ViewModel.IsLogoutEnabled, Converter={StaticResource BoolNegationConverter}, Mode=OneWay}">
				<local:SettingsBlockControl.Icon>
					<FontIcon Glyph="&#xF0B9;" />
				</local:SettingsBlockControl.Icon>
				<Button Command="{x:Bind ViewModel.ConnectToGitHubCommand}" Content="{helpers:ResourceString Name=Login}" />
			</local:SettingsBlockControl>

			<!--  Remove credentials  -->
			<local:SettingsBlockControl
				x:Name="RemoveCredentialsSection"
				Title="{helpers:ResourceString Name=ConnectedToGitHub}"
				HorizontalAlignment="Stretch"
				x:Load="{x:Bind ViewModel.IsLogoutEnabled, Mode=OneWay}">
				<local:SettingsBlockControl.Icon>
					<FontIcon Glyph="&#xF0B9;" />
				</local:SettingsBlockControl.Icon>
				<Button Command="{x:Bind ViewModel.RemoveCredentialsCommand}" Content="{helpers:ResourceString Name=Logout}" />
			</local:SettingsBlockControl>

		</StackPanel>
	</Grid>
</Page>
