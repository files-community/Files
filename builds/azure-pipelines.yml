# Copyright (c) 2023 Files Community
# Licensed under the MIT license. See the LICENSE.

trigger:
- main

name: $(BuildDefinitionName)_$(date:yyMM).$(date:dd)$(rev:rrr)

stages:
- stage: Build

  pool:
    vmImage: 'windows-latest'

  jobs:
  - job: Platform

    timeoutInMinutes: 120
    strategy:
      maxParallel: 10
      matrix:
        Debug_x64:
          buildPlatform: 'x64'
          buildConfiguration: 'Debug'
        Debug_Arm64:
          buildPlatform: 'arm64'
          buildConfiguration: 'Debug'
        Release_x64:
          buildPlatform: 'x64'
          buildConfiguration: 'Release'
        Release_x86:
          buildPlatform: 'x86'
          buildConfiguration: 'Release'
        Release_Arm64:
          buildPlatform: 'arm64'
          buildConfiguration: 'Release'

    variables:
      solutionPath: 'Files.sln'
      packagingProjectPath: './tests/Files.App (Package)/Files.Package.wapproj'
      interactionTestsProjectPath: './tests/Files.InteractionTests/Files.InteractionTests.csproj'
      appxPackageDir: '$(build.artifactStagingDirectory)\AppxPackages'

    steps:
    - template: templates/Files-BuildProjects-Steps.yml

- stage: Test
  dependsOn: Build
  jobs:

  - template: templates\Files-RunInteractionTest-Steps.yml
