# Copyright (c) 2023 Files Community
# Licensed under the MIT license. See the LICENSE.

steps:
- task: DotNetCoreCLI@2
  inputs:
    command: 'build'
    arguments: '$(interactionTestsProjectPath) --configuration x64'

- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      # Find correct folder and run app install script.
      cd $(appxPackageDir)

      $AppBundle = Get-ChildItem -Filter Files*Test -Name
      echo $AppBundle
      cd $AppBundle
      ./Install.ps1 -Force
      Get-AppxPackage
    errorActionPreference: 'continue'
    failOnStderr: true
    workingDirectory: '$(System.DefaultWorkingDirectory)'

- task: Windows Application Driver@0
  inputs:
    OperationType: 'Start'
    AgentResolution: '1080p'

- task: VSTest@2
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\*Files.InteractionTests.dll
      !**\*TestAdapter.dll
      !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'

- task: Windows Application Driver@0
  inputs:
    OperationType: 'Stop'
