# Copyright (c) 2023 Files Community
# Licensed under the MIT license. See the LICENSE.

steps:
- template: Files-UpdatePackage-Steps.yml

- template: Files-InstallDotNetSDK-Steps.yml

- template: Files-SetupBingMapSecrets-Steps.yml

- template: Files-UseVS2022Preview-Steps.yml

- template: Files-PrepareTheSolution.yml

- task: MSBuild@1
  displayName: 'Build the package project'
  inputs:
    platform: '$(buildPlatform)'
    solution: '**/*.wapproj'
    configuration: '$(buildConfiguration)'
    msbuildArguments: '
      /t:build;_GenerateAppxPackage
      /p:Configuration="$(buildConfiguration)"
      /p:Platform="$(buildPlatform)"
      /p:AppxBundle=Always
      /p:AppxBundlePlatforms="$(buildPlatform)"
      /p:AppxPackageDir="$(appxPackageDir)"
      /p:AppxPackageSigningEnabled=true
      /p:UapAppxPackageBuildMode=SideloadOnly
      /p:PackageCertificateKeyFile="$(Build.SourcesDirectory)\builds\Files_SelfSigned.pfx"
      /p:PackageCertificatePassword=""
      /p:PackageCertificateThumbprint=""'
    maximumCpuCount: true
